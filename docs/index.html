<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>doc-test</title><meta name="description" content="Documentation for doc-test"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">doc-test</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>doc-test</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-10-sockets" id="práctica-10-sockets" style="color: inherit; text-decoration: none;">
  <h1>Práctica 10: Sockets</h1>
</a>

<a href="#diego-wiederkehr-bruno-alu0101601830" id="diego-wiederkehr-bruno-alu0101601830" style="color: inherit; text-decoration: none;">
  <h5>Diego Wiederkehr Bruno, alu0101601830</h5>
</a>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-alu0101601830?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-alu0101601830/badge.svg?branch=main" alt="Coverage Status"></a></p>

<a href="#el-github-pages-se-encuentra-en-el-siguiente-link" id="el-github-pages-se-encuentra-en-el-siguiente-link" style="color: inherit; text-decoration: none;">
  <h3>El GitHub Pages se encuentra en el siguiente <a href="https://ull-esit-inf-dsi-2223.github.io/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-alu0101601830/">link</a>.</h3>
</a>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h2>Introducción</h2>
</a>
<p>En esta práctica vamos a aprender a utilizar y familiarizarnos con los módulos <code>Events</code>, <code>fs</code>, <code>child_process</code> y <code>net</code> de Node.js. A parte deberemos utilizar otra vez los paquetes <code>yargs</code> y <code>chalk</code>.</p>

<a href="#ejercicio-i" id="ejercicio-i" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio I</h2>
</a>
<p>En este ejercicio nos dan un código que hace uso del módulo <code>fs</code> de Node.js. Es un código que observa un fichero y cuando el fichero es modificado avisa por consola. Debemos realizar una traza de ejecución mostrando el contenido de la pila de llamadas, el registro de eventos de la API y la cola de manejadores, además de lo mostrado en consola. Ejecutamos el programa y hacemos dos modificaciones de un fichero <code>helloworld.txt</code>:</p>
<ol>
<li>Se hace una llamada a la función <code>access</code> y es agregada a la pila de llamadas.</li>
<li>La función <code>access</code> es completada y se extrae de la pila de llamadas.</li>
<li>Se muestra en la consola: <code>Starting to watch file src/files/helloworld.txt</code>.</li>
<li>Se hace una llamada a la función <code>watch</code> y se agrega a la pila de llamadas.</li>
<li>La función <code>watch</code> es completada y se extrae de la pila de llamadas.</li>
<li>Es registrado un manejador de eventos para <code>change</code> del objeto <code>watcher</code>.</li>
<li>Se muestra en la consola: <code>File src/files/helloworld.txt is no longer watched</code>.</li>
<li>Se modifica el archivo <code>src/files/helloworld.txt</code> y es detectada esta modificación por lo que se agrega un manejador a la cola de manejadores.</li>
<li>Se muestra en la consola: <code>File src/files/helloworld.txt has been modified somehow</code>.</li>
<li>Se ejecuta el manejador de eventos y se saca de la cola de manejadores.</li>
<li>Se modifica de nuevo el archivo y se detecta la modificación por lo que se agrega otro manejador a la cola de manejadores.</li>
<li>Se muestra en la consola: <code>File src/files/helloworld.txt has been modified somehow</code>.</li>
<li>Se ejecuta el manejador de eventos y se saca de la cola de manejadores.</li>
</ol>
<p>Una cosa que no entiendo muy bien por qué ocurre es que cada vez que el archivo es modificado, se muestra dos veces por pantalla el mensaje: <code>File src/files/helloworld.txt has been modified somehow</code>.</p>
<p>En el código del ejercicio I, la función <code>access</code> se utiliza para la comprobación de que un archivo exista. Para asegurarnos de que existe se utiliza el objeto <code>constants</code>. Este objeto tiene varias constantes disponibles pero en nuestro caso utiliza <code>constants.F_OK</code>, que es el que funciona exactamente para asegurarnos de que exista el fichero. Otra opción podría ser <code>constants.R_OK</code> que sirve para saber si un usuario tiene permisos de lectura sobre el archivo.</p>

<a href="#ejercicio-ii" id="ejercicio-ii" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio II</h2>
</a>
<p>En este ejercicio debemos realizar un código que nos permita leer un fichero y analizar el número de lineas, caracteres o palabras que hay en total a través de comandos por la terminal. En la función se puede hacer uso o no del método pipe. Primero de todo, leemos con yargs los argumentos de la terminal:</p>
<pre><code class="language-ts"><span class="hl-0">    .</span><span class="hl-1">command</span><span class="hl-0">(</span><br/><span class="hl-0">        </span><span class="hl-2">&#39;info&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">&#39;Proporciona información sobre el número de líneas, palabras o caracteres que contiene un fichero de texto&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        (</span><span class="hl-3">yargs</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-5">return</span><span class="hl-0"> </span><span class="hl-3">yargs</span><br/><span class="hl-0">                .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;ruta&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Ruta del fichero&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">})</span><br/><span class="hl-0">                .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;opcion&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Opciones de visualización (lineas, palabras, caracteres)&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">})</span><br/><span class="hl-0">                .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;pipe&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Uso de pipe&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;boolean&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">})</span><br/><br/><span class="hl-0">        },</span>
</code></pre>
<p>En esta parte leemos las tres opciones y obligamos que el usuario introduzca cada una de las variables.</p>
<pre><code class="language-ts"><span class="hl-0">        (</span><span class="hl-3">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-5">if</span><span class="hl-0"> (!</span><span class="hl-3">fs</span><span class="hl-0">.</span><span class="hl-1">existsSync</span><span class="hl-0">(</span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">ruta</span><span class="hl-0">)){</span><br/><span class="hl-0">                </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">error</span><span class="hl-0">(</span><span class="hl-2">&#39;Error: El archivo no existe&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">                </span><span class="hl-3">process</span><span class="hl-0">.</span><span class="hl-1">exit</span><span class="hl-0">(</span><span class="hl-6">1</span><span class="hl-0">);</span><br/><span class="hl-0">            }</span><br/><span class="hl-0">            </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">fichero</span><span class="hl-0"> = </span><span class="hl-3">fs</span><span class="hl-0">.</span><span class="hl-1">readFileSync</span><span class="hl-0">(</span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">ruta</span><span class="hl-0">, </span><span class="hl-2">&#39;utf-8&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">            </span><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">pipe</span><span class="hl-0"> === </span><span class="hl-4">true</span><span class="hl-0">){</span><br/><span class="hl-0">                </span><span class="hl-1">pipe</span><span class="hl-0">(</span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">ruta</span><span class="hl-0">, </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">opcion</span><span class="hl-0">);</span><br/><span class="hl-0">            }</span><span class="hl-5">else</span><span class="hl-0"> </span><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">pipe</span><span class="hl-0"> === </span><span class="hl-4">false</span><span class="hl-0">){</span><br/><span class="hl-0">                </span><span class="hl-1">noPipe</span><span class="hl-0">(</span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">ruta</span><span class="hl-0">, </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">opcion</span><span class="hl-0">);        </span><br/><span class="hl-0">            }</span><span class="hl-5">else</span><span class="hl-0">{</span><br/><span class="hl-0">                </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-2">&quot;Error con la opción de pipe&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">            }</span><br/><span class="hl-0">        }</span>
</code></pre>
<p>En esta parte hacemos primero un control de errores para asegurarnos de que el archivo existe y a continuación lo guardamos. Hacemos otro control sobre la variable <strong>pipe</strong> que se encarga de llamar a una función u a otra dependiendo del input. Después he realizado tres funciones distintas, la primera es <code>contar()</code>:</p>
<pre><code class="language-ts"><span class="hl-4">function</span><span class="hl-0"> </span><span class="hl-1">contar</span><span class="hl-0">(</span><span class="hl-3">opcion</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">, </span><span class="hl-3">texto</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-5">switch</span><span class="hl-0"> (</span><span class="hl-3">opcion</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-5">case</span><span class="hl-0"> </span><span class="hl-2">&#39;lineas&#39;</span><span class="hl-0">:</span><br/><span class="hl-0">      </span><span class="hl-5">return</span><span class="hl-0"> </span><span class="hl-3">texto</span><span class="hl-0">.</span><span class="hl-1">split</span><span class="hl-0">(</span><span class="hl-2">&#39;</span><span class="hl-9">\n</span><span class="hl-2">&#39;</span><span class="hl-0">).</span><span class="hl-3">length</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-5">case</span><span class="hl-0"> </span><span class="hl-2">&#39;palabras&#39;</span><span class="hl-0">:</span><br/><span class="hl-0">      </span><span class="hl-5">return</span><span class="hl-0"> </span><span class="hl-3">texto</span><span class="hl-0">.</span><span class="hl-1">split</span><span class="hl-0">(</span><span class="hl-10">/\s</span><span class="hl-11">+</span><span class="hl-10">/</span><span class="hl-0">).</span><span class="hl-3">length</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-5">case</span><span class="hl-0"> </span><span class="hl-2">&#39;caracteres&#39;</span><span class="hl-0">:</span><br/><span class="hl-0">      </span><span class="hl-5">return</span><span class="hl-0"> </span><span class="hl-3">texto</span><span class="hl-0">.</span><span class="hl-3">length</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-5">default</span><span class="hl-0">:</span><br/><span class="hl-0">      </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">error</span><span class="hl-0">(</span><span class="hl-2">&#39;Error: Opción no válida&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-3">process</span><span class="hl-0">.</span><span class="hl-1">exit</span><span class="hl-0">(</span><span class="hl-6">1</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>En esta función básicamente lo que hago es introducir el texto y la opción de lectura, si es <em>líneas</em>, lo separo por los saltos de líneas y cuento. Si es <em>palabras</em> utilizo en vez del salto de línea, una expresión regular que representa primero <code>\s</code> un caracter de espacio en blanco y después el <code>+</code> que indica que indica que debe haber uno o más caracteres de espacio en blanco para que se produzca una división en el texto. Finalmente utilizo <em>caracteres</em> que devuelve el tamaño del texto entero. Después de esto debo analizar si utiliza el método <code>pipe</code> o no. Mi función para usar el pipe, <code>pipe()</code>:</p>
<pre><code class="language-ts"><span class="hl-4">function</span><span class="hl-0"> </span><span class="hl-1">pipe</span><span class="hl-0">(</span><span class="hl-3">ruta</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">, </span><span class="hl-3">opciones</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">lectura</span><span class="hl-0"> = </span><span class="hl-3">fs</span><span class="hl-0">.</span><span class="hl-1">createReadStream</span><span class="hl-0">(</span><span class="hl-3">ruta</span><span class="hl-0">, </span><span class="hl-2">&#39;utf-8&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-3">data</span><span class="hl-0"> = </span><span class="hl-2">&#39;&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-3">lectura</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-3">chunk</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">data</span><span class="hl-0"> += </span><span class="hl-3">chunk</span><span class="hl-0">;</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-3">lectura</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;end&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-1">contar</span><span class="hl-0">(</span><span class="hl-3">opciones</span><span class="hl-0">, </span><span class="hl-3">data</span><span class="hl-0">));</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-3">lectura</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;error&#39;</span><span class="hl-0">, (</span><span class="hl-3">err</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">error</span><span class="hl-0">(</span><span class="hl-2">&#39;Error: &#39;</span><span class="hl-0">, </span><span class="hl-3">err</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">}</span>
</code></pre>
<p>La función utiliza el módulo <code>fs</code> de Node.js para leer el contenido del archivo de texto de forma asíncrona y en tiempo real a través de un flujo de lectura. Almaceno el contenido de todo el archivo en <code>data</code>. El primer controlador de eventos se activa cada vez que se recibe un fragmento (chunk) de dateos del flujo de lectura y voy concatenandolo. Cuando termina de leer el archivo se activa el segundo controlador de eventos y al terminar se llama a la función <code>contar()</code>. El último se registra un controlador de eventos de error y solo se activa si se produce algún error durante la lectura. La otra función para no usar el pipe, <code>noPipe()</code>:</p>
<pre><code class="language-ts"><span class="hl-4">function</span><span class="hl-0"> </span><span class="hl-1">noPipe</span><span class="hl-0">(</span><span class="hl-3">ruta</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">, </span><span class="hl-3">opciones</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-3">fs</span><span class="hl-0">.</span><span class="hl-1">readFile</span><span class="hl-0">(</span><span class="hl-3">ruta</span><span class="hl-0">, </span><span class="hl-2">&#39;utf-8&#39;</span><span class="hl-0">, (</span><span class="hl-3">err</span><span class="hl-0">, </span><span class="hl-3">data</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">err</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">error</span><span class="hl-0">(</span><span class="hl-2">&#39;Error: &#39;</span><span class="hl-0">, </span><span class="hl-3">err</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-5">return</span><span class="hl-0">;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-1">contar</span><span class="hl-0">(</span><span class="hl-3">opciones</span><span class="hl-0">, </span><span class="hl-3">data</span><span class="hl-0">));</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">}</span>
</code></pre>
<p>En esta función no uso el flujo de lectura y lee todo el archivo de una sola vez. Leo el archivo, hago un control de errores y si todo va correcto llamo a la función contar() con todo el contenido del archivo contenido en la variable <code>data</code>.</p>

<a href="#ejercicio-iii" id="ejercicio-iii" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio III</h2>
</a>
<p>En este ejercicio debía adaptar el sistema de Funkos implementado en la práctica 9 y hacerlo con un sistema de cliente y servidor de petición-respuesta. Para esto, he eliminado mi antiguo <strong>index.ts</strong> y he creado dos ficheros, <strong>cliente.ts</strong> y <strong>servidor.ts</strong>.
Primero voy a explicar cliente.ts:
Lo primero que hago en este fichero es conectarme al puerto dónde el servidor está escuchando con el módulo <em>net</em> de <strong>Node.js</strong>:
<code>const client = net.connect({port: SERVER_PORT});</code>
Lo siguiente que hago es el client.on para conectarme, leer la información de la consola y enviar la petición al servidor. Voy a explicar por ejemplo como hago add y el resto de comandos sigo la misma dinámica. Para add: </p>
<pre><code class="language-ts"><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;connect&#39;</span><span class="hl-0">, </span><span class="hl-4">async</span><span class="hl-0"> ()</span><span class="hl-4">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">(</span><span class="hl-2">&quot;Conexión satisfactoria&quot;</span><span class="hl-0">));</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">argv</span><span class="hl-0"> = </span><span class="hl-5">await</span><span class="hl-0"> </span><span class="hl-1">yargs</span><span class="hl-0">(</span><span class="hl-1">hideBin</span><span class="hl-0">(</span><span class="hl-3">process</span><span class="hl-0">.</span><span class="hl-3">argv</span><span class="hl-0">))</span><br/><span class="hl-0">      .</span><span class="hl-1">command</span><span class="hl-0">(</span><br/><span class="hl-0">        </span><span class="hl-2">&#39;add&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">&#39;Añade un Funko a la colección&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        (</span><span class="hl-3">yargs</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-5">return</span><span class="hl-0"> </span><span class="hl-3">yargs</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;user&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Nombre de usuario&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">})</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;id&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;ID del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;name&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Nombre del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;desc&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Descripción del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;type&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Tipo del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">choices:</span><span class="hl-0"> </span><span class="hl-3">Object</span><span class="hl-0">.</span><span class="hl-1">values</span><span class="hl-0">(</span><span class="hl-3">Tipo</span><span class="hl-0">), </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;genre&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Género del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">choices:</span><span class="hl-0"> </span><span class="hl-3">Object</span><span class="hl-0">.</span><span class="hl-1">values</span><span class="hl-0">(</span><span class="hl-3">Genero</span><span class="hl-0">), </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;franchise&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Franquicia del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;number&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Número del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;exclusive&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Exclusividad del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;boolean&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;specialCharacter&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Características especiales del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> })</span><br/><span class="hl-0">              .</span><span class="hl-1">option</span><span class="hl-0">(</span><span class="hl-2">&#39;value&#39;</span><span class="hl-0">, { </span><span class="hl-3">describe:</span><span class="hl-0"> </span><span class="hl-2">&#39;Valor de mercado del Funko&#39;</span><span class="hl-0">, </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-0">, </span><span class="hl-3">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">        (</span><span class="hl-3">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">newFunko</span><span class="hl-0">: </span><span class="hl-8">Funko</span><span class="hl-0"> = {</span><br/><span class="hl-0">                </span><span class="hl-3">id:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">id</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">nombre:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">name</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">descripcion:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">desc</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">tipo:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">type</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">genero:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">genre</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">franquicia:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">franchise</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">numero:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">number</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">exclusivo:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">exclusive</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">caracteristicasEspeciales:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">specialCharacter</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-3">valorDeMercado:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">value</span><br/><span class="hl-0">            };</span><br/><span class="hl-0">            </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">request</span><span class="hl-0">: </span><span class="hl-8">RequestType</span><span class="hl-0"> = {</span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;add&#39;</span><span class="hl-0">, </span><span class="hl-3">user:</span><span class="hl-0"> </span><span class="hl-3">argv</span><span class="hl-0">.</span><span class="hl-3">user</span><span class="hl-0">, </span><span class="hl-3">funkoPop:</span><span class="hl-0"> </span><span class="hl-3">newFunko</span><span class="hl-0">};</span><br/><span class="hl-0">            </span><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-1">write</span><span class="hl-0">(</span><span class="hl-7">JSON</span><span class="hl-0">.</span><span class="hl-1">stringify</span><span class="hl-0">(</span><span class="hl-3">request</span><span class="hl-0">));</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      )</span>
</code></pre>
<p>Leo primero la información por la consola con los datos del funko utilizando el módulo <strong>yargs</strong>, luego creo un funko nuevo y por último lo que he utilizado para enviar la petición es crear un tipo como el que nos dan en el enunciado de la práctica, en mi caso es así:</p>
<pre><code class="language-ts"><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-4">type</span><span class="hl-0"> </span><span class="hl-8">RequestType</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-3">type</span><span class="hl-0">: </span><span class="hl-2">&#39;add&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;update&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;remove&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;read&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;list&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-3">user</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-3">funkoPop</span><span class="hl-0">?: </span><span class="hl-8">Funko</span><span class="hl-0">;</span><br/><span class="hl-0">};</span>
</code></pre>
<p>Entonces creo una variable <code>request</code> de tipo <code>RequestType</code> y ahí añado el comando <code>add</code>, el nombre del usuario con <code>argv.user</code> y el funko nuevo que he creado. Luego utilizo <code>client.write</code> y mando al servidor el tipo con <code>JSON.stringify</code>. Esto mismo lo utilizo en cada comando pero adaptando al tipo de comando y por ejemplo para read, list o remove, creo funkos vación solo con el id y en el servidor se encarga solo de leer el id y hacer lo que tenga que hacer.</p>
<p>Después de manejar toda la parte de enviar datos al servidor, creo la parte para recibir datos:</p>
<pre><code class="language-ts"><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-3">data</span><span class="hl-0">)</span><span class="hl-4">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">message</span><span class="hl-0"> = </span><span class="hl-7">JSON</span><span class="hl-0">.</span><span class="hl-1">parse</span><span class="hl-0">(</span><span class="hl-3">data</span><span class="hl-0">.</span><span class="hl-1">toString</span><span class="hl-0">());</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-2">&quot;---------------------DATA--------------------------&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">yellow</span><span class="hl-0">(</span><span class="hl-2">&quot;El servidor dice:&quot;</span><span class="hl-0">))</span><br/><span class="hl-0">    </span><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">success</span><span class="hl-0">){</span><br/><span class="hl-0">        </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">(</span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0">));</span><br/><span class="hl-0">    }</span><span class="hl-5">else</span><span class="hl-0">{</span><br/><span class="hl-0">        </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">(</span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0">));</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-2">&quot;---------------------------------------------------&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>
<p>En esta parte estoy escuchando lo que haya recibido de información para mostrar en rojo, para ello hago el parse del JSON que explicaré más tarde en el servidor, pero básicamente tengo una variable que se llama success para asegurarme de que el resultado sea válido o no, si ha ido bien lo imprimo verde y si no, en rojo.
Lo último que tengo es la parte de error que muestro en rojo si hay alguno:</p>
<pre><code class="language-ts"><span class="hl-3">client</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;error&#39;</span><span class="hl-0">, (</span><span class="hl-3">err</span><span class="hl-0">)</span><span class="hl-4">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">(</span><span class="hl-3">err</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0">));</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-2">&quot;---------------------------------------------------&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>
<p>Ahora para el servidor, realizo lo siguiente:
Primero creo el server con <code>net.createServer</code> y dentro manejo el coket de la siguiente forma, primero debo recibir información del cliente ya que el servidor se queda a la escucha y espera a que reciba datos, asi que dentro de <code>socket.on(&#39;data)</code> primero parseo la información que me ha llegado del cliente (en nuestro caso un tipo de RequestType con la información necesaria). Ajusto el usuario recibido y el funko recibido:</p>
<pre><code class="language-ts"><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">message</span><span class="hl-0"> = </span><span class="hl-7">JSON</span><span class="hl-0">.</span><span class="hl-1">parse</span><span class="hl-0">(</span><span class="hl-3">data</span><span class="hl-0">.</span><span class="hl-1">toString</span><span class="hl-0">());</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">command</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">type</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">user</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">user</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">funko</span><span class="hl-0">: </span><span class="hl-8">Funko</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">funkoPop</span><span class="hl-0">;</span>
</code></pre>
<p>Luego genero una respuesta que voy a pasarle de JSON pero de tipo ResponseType y un funkoOperations con el usuario recibido desde el cliente para realizar las operaciones:</p>
<pre><code class="language-ts"><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">response</span><span class="hl-0">: </span><span class="hl-8">ResponseType</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-3">type:</span><span class="hl-0"> </span><span class="hl-2">&#39;read&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-3">success:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-3">funkoPop:</span><span class="hl-0"> </span><span class="hl-3">funko</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-3">message:</span><span class="hl-0"> </span><span class="hl-2">&quot;test&quot;</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">funkoOperations</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-1">FunkoOperations</span><span class="hl-0">(</span><span class="hl-3">user</span><span class="hl-0">);</span><br/>
</code></pre>
<p>ResponseType tiene una estructura de la siguiente forma:</p>
<pre><code class="language-ts"><span class="hl-5">export</span><span class="hl-0"> </span><span class="hl-4">type</span><span class="hl-0"> </span><span class="hl-8">ResponseType</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-3">type</span><span class="hl-0">: </span><span class="hl-2">&#39;add&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;update&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;remove&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;read&#39;</span><span class="hl-0"> | </span><span class="hl-2">&#39;list&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-3">success</span><span class="hl-0">: </span><span class="hl-8">boolean</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-3">funkoPop</span><span class="hl-0">?: </span><span class="hl-8">Funko</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-3">message</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">;</span><br/><span class="hl-0">};</span>
</code></pre>
<p>Después voy a manejar cada uno de los comandos con un switch y voy a explicar como funciona para el comando <strong>add</strong> ya que el resto funcionan de la misma forma: </p>
<pre><code class="language-ts"><span class="hl-0">    </span><span class="hl-5">switch</span><span class="hl-0"> (</span><span class="hl-3">command</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-5">case</span><span class="hl-0"> </span><span class="hl-2">&quot;add&quot;</span><span class="hl-0">:</span><br/><span class="hl-0">        </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-7">prueba_add</span><span class="hl-0"> = </span><span class="hl-3">funkoOperations</span><span class="hl-0">.</span><span class="hl-1">addFunko</span><span class="hl-0">(</span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">funkoPop</span><span class="hl-0">, </span><span class="hl-3">user</span><span class="hl-0">);</span><br/><span class="hl-0">        </span><span class="hl-5">if</span><span class="hl-0"> (</span><span class="hl-3">prueba_add</span><span class="hl-0"> === </span><span class="hl-4">true</span><span class="hl-0">){</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">success</span><span class="hl-0"> = </span><span class="hl-4">true</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">type</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">type</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">funkoPop</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">funko</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0"> = </span><span class="hl-2">`New Funko added to </span><span class="hl-4">${</span><span class="hl-3">user</span><span class="hl-4">}</span><span class="hl-2"> collection!`</span><span class="hl-0">;</span><br/><span class="hl-0">        }</span><span class="hl-5">else</span><span class="hl-0">{</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">success</span><span class="hl-0"> = </span><span class="hl-4">false</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">type</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">type</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">funkoPop</span><span class="hl-0"> = </span><span class="hl-3">message</span><span class="hl-0">.</span><span class="hl-3">funko</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-3">response</span><span class="hl-0">.</span><span class="hl-3">message</span><span class="hl-0"> = </span><span class="hl-2">`Funko already exists at </span><span class="hl-4">${</span><span class="hl-3">user</span><span class="hl-4">}</span><span class="hl-2"> collection!`</span><span class="hl-0">;</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-3">socket</span><span class="hl-0">.</span><span class="hl-1">write</span><span class="hl-0">(</span><span class="hl-7">JSON</span><span class="hl-0">.</span><span class="hl-1">stringify</span><span class="hl-0">(</span><span class="hl-3">response</span><span class="hl-0">));</span><br/><span class="hl-0">        </span><span class="hl-5">break</span><span class="hl-0">;</span>
</code></pre>
<p>He modificado el fichero funkoOperations para recibir información de si se ha ejecutado la operación correctamente o no, por eso tengo la variable <code>prueba_add</code>. Hago un if con la condición necesaria y en caso de que sea true, la respuesta tiene la variable success en true, el mensaje tiene el tipo (el comando introducido), el funkoPop es el mismo que se ha enviado y finalmente el mensaje que le va a enviar al cliente y este va a imprimir por la terminal. En algunos casos el mensaje es simplemente para ver si ya existe o no como en el ejemplo de add pero por ejemplo en read, en el mensaje si se ha encontrado el funko es imprimir la información sobre el funko, asi que el mensaje es la propia información.
Finalmente utilizo <code>socket.write(JSON.stringify(response))</code> y un <em>break</em> para enviar al cliente por el socket y salir del switch.</p>
<p>Después de todos los comandos tengo para mostrar información si el cliente se desconecta:</p>
<pre><code class="language-ts"><span class="hl-0">  </span><span class="hl-3">socket</span><span class="hl-0">.</span><span class="hl-1">on</span><span class="hl-0">(</span><span class="hl-2">&#39;end&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">(</span><span class="hl-2">&#39;Client disconnected&#39;</span><span class="hl-0">));</span><br/><span class="hl-0">    </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-2">&quot;---------------------------------------------------&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span>
</code></pre>
<p>Y dónde está escuchando el server:</p>
<pre><code class="language-ts"><span class="hl-3">server</span><span class="hl-0">.</span><span class="hl-1">listen</span><span class="hl-0">(</span><span class="hl-7">SERVER_PORT</span><span class="hl-0">, </span><span class="hl-7">SERVER_HOST</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-2">&quot;---------------------CONEXION----------------------&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-3">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">(</span><span class="hl-3">chalk</span><span class="hl-0">.</span><span class="hl-1">yellow</span><span class="hl-0">(</span><span class="hl-2">`Server listening on </span><span class="hl-4">${</span><span class="hl-7">SERVER_HOST</span><span class="hl-4">}</span><span class="hl-2">:</span><span class="hl-4">${</span><span class="hl-7">SERVER_PORT</span><span class="hl-4">}</span><span class="hl-2">`</span><span class="hl-0">));</span><br/><span class="hl-0">});</span>
</code></pre>

<a href="#tests-y-github-actions" id="tests-y-github-actions" style="color: inherit; text-decoration: none;">
  <h2>Tests y GitHub Actions</h2>
</a>
<p>Todos los GitHub Actions me dan sin error:</p>
<p align="center">
<img width="656" alt="github actions" src="https://user-images.githubusercontent.com/117380181/232135539-9178a77b-fdf8-4eba-9ede-ac256e8b18d0.png">
</p>
Los tests se han realizado con Mocha Chai y sus resultados son los siguientes:
<p align="center">
<img width="548" alt="tests" src="https://user-images.githubusercontent.com/117380181/232135583-60bcb930-1a61-449d-9049-09792f171b44.png">
</p>
Los resultados del Coverall son los siguientes:
<p align="center">
<img width="464" alt="coverage" src="https://user-images.githubusercontent.com/117380181/232135637-8d074c63-585a-4739-8d41-9dd11a3cdc13.png">

</p>
No está todo el código cubierto pero hay mucha parte de los JSON que no se como tratarlo o sobre errores en pantalla.


<a href="#ejemplos-de-ejecución" id="ejemplos-de-ejecución" style="color: inherit; text-decoration: none;">
  <h2>Ejemplos de ejecución</h2>
</a>
<p><strong>Añado un Funko</strong></p>
<p align="center">
<img width="659" alt="Añadir funko" src="https://user-images.githubusercontent.com/117380181/232135665-7986888b-29bf-4877-a581-9005597f5596.png">
</p>
**Añado el mismo Funko**
<p align="center">
<img width="657" alt="añado mismo funko" src="https://user-images.githubusercontent.com/117380181/232135739-9874101a-dda2-4ea1-934b-fc33ca30ee7a.png">
</p>
**Muestro la información del primer Funko**
<p align="center">
<img width="652" alt="leer funko" src="https://user-images.githubusercontent.com/117380181/232135783-e35ec170-da7e-4cc8-8011-da33d14d8b19.png">
</p>
**Elimino el primer Funko**
<p align="center">
<img width="656" alt="eliminar funko" src="https://user-images.githubusercontent.com/117380181/232135804-6338c464-b71a-45ee-bfd2-be35757ef64d.png">
</p>


<a href="#conclusión" id="conclusión" style="color: inherit; text-decoration: none;">
  <h2>Conclusión</h2>
</a>
<p>En esta práctica he aprendido a utilizar la petición-respuesta de un cliente y servidor utilizando el módulo net de Node.js y otras herramientas. Una cosa que no he conseguido arreglar es cerrar el cliente buscando una solución alternativa al end.</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">doc-<wbr/>test</a>
<ul>
<li class="tsd-kind-module"><a href="modules/ejercicio_2.html">ejercicio-<wbr/>2</a></li>
<li class="tsd-kind-module"><a href="modules/funko.html">funko</a></li>
<li class="tsd-kind-module"><a href="modules/funkoOperations.html">funko<wbr/>Operations</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>